namespace: monk-wordpress

db:
  defines: runnable
  inherits: mysql/latest
  variables:
    defines: variables
    mysql_database:
      type: string
      value: "wpdb"
    rpc-port:
      type: int
      value: 3306
    image-tag:
      type: string
      value: latest
    mysql_user:
      type: string
      value: "db_user"
    mysql_root_password:
      type: string
      value: "RhgDPXPEnAgJ5q5g"
    mysql_password:
      type: string
      value: "RhgDPXPEnAgxxXYZ"
  checks:
    readiness:
      code: "true"
      period: 15
      initialDelay: 10

web:
  defines: runnable
  containers:
    wordpress:
      image: docker.io/wordpress
      paths:
        - <- `${wordpress-data-path}:/var/www/html`                                     
      ports:
        - - <- `0.0.0.0:${wordpress-port}:8080`
        - 443
  depends:
    wait-for:
      runnables:
        - monk-wordpress/db
      timeout: 30
  variables:
    wordpress-port:
      type: int
      value: 80
    wordpress-db-user:
      env: WORDPRESS_DB_USER
      type: string
      value: "value"
    wordpress-db-password:
      env: WORDPRESS_DB_PASSWORD
      type: string
      value: "value"
    wordpress-db-name:
      env: WORDPRESS_DB_NAME
      type: string
    wordpress-db-host:
      env: WORDPRESS_DB_HOST
      type: string
      value: <- get-hostname("wordpress/db", "mysql")
    wordpress-data-path:
      type: string
      value: <- `${monk-volume-path}/wordpress/web`